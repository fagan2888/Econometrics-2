# Lecture 1：検出力とサンプルサイズ設計の意義

<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->


  - [1.1 : 検定における２種類の誤り](#11--%E6%A4%9C%E5%AE%9A%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%EF%BC%92%E7%A8%AE%E9%A1%9E%E3%81%AE%E8%AA%A4%E3%82%8A)
    - [いかさまコインを見破れ](#%E3%81%84%E3%81%8B%E3%81%95%E3%81%BE%E3%82%B3%E3%82%A4%E3%83%B3%E3%82%92%E8%A6%8B%E7%A0%B4%E3%82%8C)
    - [検定結果の解釈](#%E6%A4%9C%E5%AE%9A%E7%B5%90%E6%9E%9C%E3%81%AE%E8%A7%A3%E9%87%88)
  - [1-2 : 検出力とサンプルサイズの設計](#1-2--%E6%A4%9C%E5%87%BA%E5%8A%9B%E3%81%A8%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B5%E3%82%A4%E3%82%BA%E3%81%AE%E8%A8%AD%E8%A8%88)
    - [例](#%E4%BE%8B)
      - [検出力の設定](#%E6%A4%9C%E5%87%BA%E5%8A%9B%E3%81%AE%E8%A8%AD%E5%AE%9A)
  - [1-4: $\alpha$と$\beta$の注意点](#1-4-%5Calpha%E3%81%A8%5Cbeta%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9)
- [2 : 練習問題](#2--%E7%B7%B4%E7%BF%92%E5%95%8F%E9%A1%8C)
  - [Q1](#q1)
    - [(1) Type I Errorの確率を誤りを求めよ](#1-type-i-error%E3%81%AE%E7%A2%BA%E7%8E%87%E3%82%92%E8%AA%A4%E3%82%8A%E3%82%92%E6%B1%82%E3%82%81%E3%82%88)
    - [(2) P = 0.6 のときのType II Errorの確率を誤りを求めよ](#2-p--06-%E3%81%AE%E3%81%A8%E3%81%8D%E3%81%AEtype-ii-error%E3%81%AE%E7%A2%BA%E7%8E%87%E3%82%92%E8%AA%A4%E3%82%8A%E3%82%92%E6%B1%82%E3%82%81%E3%82%88)
    - [(2) P = 0.8 のときのType II Errorの確率を誤りを求めよ](#2-p--08-%E3%81%AE%E3%81%A8%E3%81%8D%E3%81%AEtype-ii-error%E3%81%AE%E7%A2%BA%E7%8E%87%E3%82%92%E8%AA%A4%E3%82%8A%E3%82%92%E6%B1%82%E3%82%81%E3%82%88)
  - [Q2](#q2)
    - [(1) Type I Errorの確率を誤りを求めよ](#1-type-i-error%E3%81%AE%E7%A2%BA%E7%8E%87%E3%82%92%E8%AA%A4%E3%82%8A%E3%82%92%E6%B1%82%E3%82%81%E3%82%88-1)
    - [(2) P = 0.6 のときのType II Errorの確率を誤りを求めよ](#2-p--06-%E3%81%AE%E3%81%A8%E3%81%8D%E3%81%AEtype-ii-error%E3%81%AE%E7%A2%BA%E7%8E%87%E3%82%92%E8%AA%A4%E3%82%8A%E3%82%92%E6%B1%82%E3%82%81%E3%82%88-1)
    - [(2) P = 0.8 のときのType II Errorの確率を誤りを求めよ](#2-p--08-%E3%81%AE%E3%81%A8%E3%81%8D%E3%81%AEtype-ii-error%E3%81%AE%E7%A2%BA%E7%8E%87%E3%82%92%E8%AA%A4%E3%82%8A%E3%82%92%E6%B1%82%E3%82%81%E3%82%88-1)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

## 1.1 : 検定における２種類の誤り
- Type I error (False Positive): 検定において、本当は帰無仮説$H_0$が成り立っているにもかかわらず$H_0$を棄却する
- Type II error (False Negative) : $H_0$が成り立っていないのに$H_0$を棄却できない

<img src = "https://github.com/RyoNakagami/omorikaizuka/blob/master/samplesize/d0194774_2228349.jpg?raw=true">

火災報知器を例にすると、Type I errorは「火事が発生していないのに火災報知器がなる」火災報知器の誤作動、Type II errorは「火事が発生しているにも関わらず昨日しない」という誤作動。

### いかさまコインを見破れ
あるコインがイカサマコインであるかどうかが問題になったとする。帰無仮説と対立仮説を次のように設定する

- $H_0$ : 正しいコインである（$P = 0.5$）
- $H_1$ : イカサマコインである($P \neq 0.5$)

ここでPはそのコインを投げたとき表が出る確率。仮に$H_0$の棄却方式を次のように定める

- $H_0$の棄却方式 : 6回投げて $x = 6$ または $x = 0$ならば$H_0$を棄却

$H_0$を棄却するときは、「そのコインはイカサマコインである」と判断する。このときのType I error rateは

$$
\alpha = 0.5^6 + 0.5^6 = 0.0313
$$
一方、真の値が$P = 0.6$のときのType II errorは
$$
\beta = 1 - (0.6^6 + 0.4^4) = 0.9492
$$

$\alpha$は他のパラメーターに依存しないが、$\beta$はsample size, $\alpha$, effect sizeに依存する。 

### 検定結果の解釈
- $H_0$を棄却するならば正しい結果であるか、誤りであったとしてもその確率は$\alpha$で非常に小さいので積極的に結果を述べることができる
- 検定結果が$H_0$を棄却できないとなると、正しい結果かもしれないが、高い確率$\beta$の誤りを犯している可能性があるので、消極的にしか結果を述べることができない

そのため、一般的には「アクションに結びつくような内容を対立仮説に設定する」とされる。どちらにせよ、意思決定に用いることができない検定は意味がないので、そこを考えながらケースバイケースで設定する。

## 1-2 : 検出力とサンプルサイズの設計
$H_1$が成り立っているときに$H_0$を正しく棄却する確率を検出力（power）と呼ぶ。つまり$1-\beta$。検出力は真のパラメータに応じて異なる（検出力曲線の導出は課題）。$H_0$を断定的に結論づけることが必要な場合、

- パラメーターが$H_0$で示されている値よりも$\Delta_0$以上の差がある場合には高い検出力を保証できるようにしたい
- そのような検出力を得るためにはサンプルサイズをどのくらいにすれば良いのか？

を考える。

### 例
ある製品に対して新しい製造方法の導入を考えている。新しい製造方法を用いたときの製品強度の母平均を$\mu$とし、従来の製造方法を用いたときの製品強度の母平均を$\mu_0$とする。$\mu_0$は既知であるとする。

新しい製造方法を用いるとコストダウンになるので、$\mu$が$\mu_0$より$\Delta_0$以上小さくなることがないなら新しい製造方法に切り替えたいとする。このとき

- $H_0: \mu = \mu_0$
- $H_1 : \mu < \mu_0$ 

とし、棄却されないならば新しい製造方法をとる。ただしサンプルサイズは$\mu\leq \mu_0 - \Delta_0$が高い確率$1-\beta$, 0.9, で検出できるように設計する。


#### 検出力の設定
- $\alpha : 0.05$
- $\beta : 0.2$

が一般的。

## 1-4: $\alpha$と$\beta$の注意点
t値の値を$t$、$\alpha$を検出水準、$T^*$を$H_1$が成立する確率、$N^*$を$H_0$が成立する確率とする。とあるt検定を実施した場合、p-valueが0.05であったとする。これは必ずしも$Pr(N^*|t) = 0.05$を意味しない。

$$
Pr(N^*|t) = \frac{Pr(t|N^*)}{Pr(t)}Pr(N^*)
$$
あくまで$Pr(t|N^*) = 0.05$。

# 2 : 練習問題
## Q1
「５回投げて $x = 5$または $x = 0$であるときに$H_0$を棄却する」という$H_0$の棄却方式を採用する。
### (1) Type I Errorの確率を誤りを求めよ
$$
_5C_5\times 0.5^5 + _5C_0\times 0.5^5 = 0.0625
$$

### (2) P = 0.6 のときのType II Errorの確率を誤りを求めよ
$$
\begin{aligned}
1 - (_5C_5\times 0.6^5 + _5C_0\times 0.4^5) & = 1 - (6**5 + 4 **5)/10**5\\
& = 0.912
\end{aligned}
$$

### (2) P = 0.8 のときのType II Errorの確率を誤りを求めよ
$$
\begin{aligned}
1 - (_5C_5\times 0.8^5 + _5C_0\times 0.2^5) & = 1 - (8**5 + 2 **5)/10**5\\
& = 0.672
\end{aligned}
$$

## Q2
「５回投げて$x \geq 4$または $x \leq 1$であるときに$H_0$を棄却する」という棄却方式を採用する
### (1) Type I Errorの確率を誤りを求めよ
$$
\begin{algned}
_5C_5\times 0.5^5 + _5C_4\times 0.5^4(1-0.5) + _5C_1\times 0.5^1(1-0.5)^4 +_5C_0\times 0.5^5 = 0.3125 + 0.0625 = 0.375
\end{aligned}
$$

### (2) P = 0.6 のときのType II Errorの確率を誤りを求めよ
$$
\begin{aligned}
1 - (_5C_5\times 0.6^5 + _5C_4\times 0.6^4(1-0.6) + _5C_1\times 0.6^1(1-0.6)^4+ _5C_0\times 0.4^5) & = 1 - (6**5 + 4 **5)/10**5\\
& = 0.576
\end{aligned}
$$

### (2) P = 0.8 のときのType II Errorの確率を誤りを求めよ
$$
\begin{aligned}
1 - (_5C_5\times 0.8^5 + _5C_0\times 0.2^5) & = 1 - (8**5 + 2 **5)/10**5\\
& = 0.256
\end{aligned}
$$